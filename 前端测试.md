# Vitest 学习指南（Vue 组件测试快速上手）

---

## 1. 核心必学 API

### 测试用例相关

| API                         | 用法                        | 作用             |
| --------------------------- | --------------------------- | ---------------- |
| `test(name, fn)`            | `test('adds', () => {...})` | 定义一个测试用例 |
| `test.only(name, fn)`       | 只跑这一个测试              | 排查单个测试     |
| `test.skip(name, fn)`       | 跳过这个测试                | 暂时屏蔽测试用例 |
| `test.concurrent(name, fn)` | 并行执行测试                | 提升速度         |
| `test.describe(name, fn)`   | 分组测试用例                | 给测试加结构     |

### 断言相关

| API                                | 用法                  | 作用                     |
| ---------------------------------- | --------------------- | ------------------------ |
| `expect(value).toBe(x)`            | `expect(2+2).toBe(4)` | 严格相等                 |
| `expect(value).toEqual(x)`         | 对象/数组深度比较     | 常用在 props、state      |
| `expect(value).toHaveLength(n)`    | 检查数组/字符串长度   |                          |
| `expect(value).toContain(x)`       | 检查数组或字符串包含  |                          |
| `expect(value).toMatchObject(obj)` | 部分对象匹配          | Vue 组件 props/emit 验证 |

> ⚠️ Vitest 的断言和 Jest 非常类似，熟悉 Jest 的 expect 就能直接用。

---

## 2. 测试生命周期（setup / teardown）

- `beforeAll(fn)`：所有测试前执行一次
- `beforeEach(fn)`：每个测试前执行
- `afterEach(fn)`：每个测试后执行
- `afterAll(fn)`：所有测试后执行

> 用于初始化数据、清理 DOM 或 mock 状态

---

33333333333333333333333## 3. 扩展测试上下文（进阶）

- `test.extend({...})`
- 给测试用例注入自定义上下文（props、store、模拟 API 等）
- 类似：`myTest({ todos })` 可以在测试前初始化数据，测试后清理

> 初学时先了解概念，实际用到组件库测试再深入。

---

## 4. Mock & Spy（可选，进阶）

- `vi.fn()` → 模拟函数
- `vi.spyOn(obj, 'method')` → 监听函数调用
- `vi.mock('模块路径')` → mock 模块依赖

> 如果你的 Vue 组件有依赖或异步请求，这些 API 非常有用。

---

## 5. 测试环境

- `jsdom` → 模拟浏览器，测试 Vue 组件 DOM
- `node` → 纯 Node 环境，测试工具函数或服务端逻辑

> Vitest 默认会根据环境自动处理。

---

## 🔹 高效学习策略

1. **先用核心 API 写几个简单的测试**

   - 函数测试、数组测试、对象测试

2. **加上生命周期钩子**

   - 熟悉 `beforeEach`、`afterEach`

3. **练习 Vue 组件测试**

   - 安装 `@vue/test-utils`，写 props、slots、events 测试

4. **再学 extend / mock / spy**

   - 解决实际组件库复杂场景

> ✅ 关键思路：先能写测试、跑测试，再学高级功能。  
> 不用一次全部学完 API，实战驱动学习效果最好。
